<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, maximum-scale=1"/>
  <title>Ton21 Mine</title>

  <!-- TonPlay SDK (–Ω–∞ –±—É–¥—É—â–µ–µ –¥–ª—è real ads) -->
  <script src="https://sdk.tonplay.io/sdk.js"></script>
  <!-- PixiJS ‚Äî –∏–≥—Ä–æ–≤–æ–π –¥–≤–∏–∂–æ–∫ -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/7.4.0/pixi.min.js"></script>

  <style>
    :root{
      --bg:#050813;
      --panel:#0f1624;
      --gold1:#ffdf88;
      --gold2:#f0cf6d;
      --txt:#e8ecf7;
      --muted:#9fb0c3;
      --accent:#25d366;
      --danger:#ff4e4e;
    }
    *{box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,"SF Pro Text",system-ui,sans-serif}
    body{
      margin:0;
      min-height:100vh;
      background:radial-gradient(1200px 700px at 50% -10%, #1b2232 0%, #050813 55%, #020308 100%);
      color:var(--txt);
      display:flex;
      justify-content:center;
      align-items:flex-start;
      padding:16px;
    }
    .app{
      width:100%;
      max-width:420px;
      background:linear-gradient(145deg,#0c111c,#10182a);
      border-radius:18px;
      padding:14px 12px 18px;
      box-shadow:0 0 40px rgba(0,0,0,0.6);
      border:1px solid rgba(255,255,255,0.06);
      position:relative;
      overflow:hidden;
    }
    .header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:8px;
    }
    .logo{
      display:flex;
      align-items:center;
      gap:8px;
    }
    .logo-circle{
      width:32px;height:32px;border-radius:50%;
      background:conic-gradient(from 160deg,var(--gold1),var(--gold2),#caa24f,var(--gold1));
      display:flex;align-items:center;justify-content:center;
      color:#1a1204;font-weight:900;font-size:18px;
      box-shadow:0 0 14px rgba(240,207,109,0.55);
    }
    .title-main{font-size:16px;font-weight:700;}
    .title-sub{font-size:11px;color:var(--muted);}
    .pill{
      padding:5px 8px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.12);
      font-size:10px;
      color:var(--muted);
    }

    .lang-switch{
      display:flex;
      gap:4px;
      margin-top:4px;
      justify-content:flex-end;
      flex-wrap:wrap;
    }
    .lang-pill{
      border:none;
      border-radius:999px;
      padding:3px 6px;
      font-size:10px;
      cursor:pointer;
      background:rgba(5,9,19,0.9);
      color:var(--muted);
      border:1px solid rgba(255,255,255,0.06);
    }
    .lang-pill.active{
      background:linear-gradient(135deg,var(--gold1),var(--gold2));
      color:#1a1307;
      border-color:transparent;
      font-weight:700;
    }

    .panel{
      background:radial-gradient(circle at 0 0,rgba(240,207,109,0.08),transparent 55%);
      border-radius:14px;
      padding:10px;
      border:1px solid rgba(255,255,255,0.06);
      margin-bottom:10px;
    }
    .panel-title{
      font-size:12px;
      color:var(--muted);
      margin-bottom:4px;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    .row{display:flex;gap:8px;flex-wrap:wrap;}
    .stat-box{
      flex:1;min-width:0;
      background:#050913;
      border-radius:10px;
      border:1px solid rgba(255,255,255,0.06);
      padding:6px 7px;
      font-size:11px;
    }
    .stat-label{color:var(--muted);margin-bottom:2px;}
    .stat-value{font-size:15px;font-weight:700;}

    /* –°—Ü–µ–Ω–∞ –¥–ª—è –Ω–∞—Å—Ç–æ—è—â–µ–π –∏–≥—Ä—ã (—Å—é–¥–∞ –≤—Å—Ç–∞–≤–∏—Ç—Å—è canvas PixiJS) */
    .mine-scene{
      position:relative;
      width:100%;
      height:190px;
      border-radius:12px;
      background:linear-gradient(to bottom,#131b2b 0%,#151b28 28%,#090d15 29%,#070a12 100%);
      border:1px solid rgba(255,255,255,0.1);
      overflow:hidden;
      margin-bottom:8px;
    }
    #gameRoot canvas{
      width:100%!important;
      height:100%!important;
      display:block;
    }

    .mine-info{
      margin-top:4px;
      font-size:11px;
      color:var(--muted);
      display:flex;
      justify-content:space-between;
      gap:8px;
      flex-wrap:wrap;
    }

    .btn-primary{
      width:100%;
      margin-top:6px;
      border:none;
      border-radius:999px;
      padding:11px 12px;
      font-size:15px;
      font-weight:700;
      cursor:pointer;
      color:#1b1307;
      background:linear-gradient(135deg,var(--gold1),var(--gold2));
      box-shadow:0 0 18px rgba(240,207,109,0.65);
    }
    .btn-primary:active{transform:scale(0.97);}
    .btn-sm{
      flex:1;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.08);
      background:#050913;
      color:var(--muted);
      font-size:11px;
      padding:6px 7px;
      cursor:pointer;
    }
    .btn-sm:active{transform:scale(0.97);}
    .btn-sm.green{border-color:rgba(37,211,102,0.4);}
    .btn-sm.gold{border-color:rgba(240,207,109,0.5);}
    .btn-sm.red{border-color:rgba(255,78,78,0.6);}

    .res-list{
      font-size:11px;
      display:grid;
      grid-template-columns:1.1fr 1fr;
      gap:3px 6px;
    }
    .res-name{color:var(--muted);}
    .res-val{text-align:right;font-weight:600;}

    .log{
      font-size:11px;
      color:var(--muted);
      max-height:90px;
      overflow-y:auto;
      margin-top:6px;
    }
    .log-line{margin-bottom:3px;}
    .bank-info{font-size:11px;color:var(--muted);margin-top:4px;}

    /* overlay –¥–ª—è —Ä–µ–∫–ª–∞–º—ã 7 —Å–µ–∫ */
    .ad-overlay{
      position:absolute;
      inset:0;
      background:rgba(0,0,0,0.82);
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      color:var(--txt);
      font-size:14px;
      text-align:center;
      padding:20px;
      z-index:20;
      backdrop-filter:blur(4px);
      display:none;
    }
    .ad-timer{
      margin-top:8px;
      font-size:18px;
      font-weight:700;
      color:var(--gold1);
    }
  </style>
</head>
<body>
<div class="app">

  <div class="ad-overlay" id="adOverlay">
    <div id="adText">Ad is playing...</div>
    <div class="ad-timer" id="adTimer">7</div>
  </div>

  <div class="header">
    <div class="logo">
      <div class="logo-circle">T</div>
      <div>
        <div class="title-main" id="titleMain">Ton21 Mine</div>
        <div class="title-sub" id="titleSub">Early access mining</div>
      </div>
    </div>
    <div>
      <div class="pill">
        <span id="depthLabel">Depth</span>:
        <span id="depthLevel">1</span>
      </div>
      <div class="lang-switch">
        <button class="lang-pill" data-lang="en" id="lang-en">EN</button>
        <button class="lang-pill" data-lang="ru" id="lang-ru">RU</button>
        <button class="lang-pill" data-lang="cn" id="lang-cn">CN</button>
        <button class="lang-pill" data-lang="in" id="lang-in">IN</button>
        <button class="lang-pill" data-lang="am" id="lang-am">AM</button>
      </div>
    </div>
  </div>

  <!-- –ë–∞–ª–∞–Ω—Å—ã -->
  <div class="panel">
    <div class="panel-title" id="balancesTitle">Balances</div>
    <div class="row">
      <div class="stat-box">
        <div class="stat-label" id="lblCommon">Common ore</div>
        <div class="stat-value" id="commonOre">0</div>
      </div>
      <div class="stat-box">
        <div class="stat-label" id="lblRare">Rare ore</div>
        <div class="stat-value" id="rareOre">0</div>
      </div>
      <div class="stat-box">
        <div class="stat-label" id="lblEpic">Epic ore</div>
        <div class="stat-value" id="epicOre">0</div>
      </div>
    </div>
    <div class="row" style="margin-top:6px;">
      <div class="stat-box">
        <div class="stat-label" id="lblDiamonds">Diamonds üíé</div>
        <div class="stat-value" id="diamondsVal">0</div>
      </div>
      <div class="stat-box">
        <div class="stat-label" id="lblT21">T21 (in game)</div>
        <div class="stat-value" id="t21Val">0</div>
      </div>
    </div>
  </div>

  <!-- –°—Ü–µ–Ω–∞ –∏–≥—Ä—ã -->
  <div class="panel">
    <div class="panel-title">
      <span id="mineTitle">Mining</span>
      <span style="font-size:11px;color:var(--muted);" id="toolInfo">
        Pickaxe durability: <span id="toolDurability">200</span>
      </span>
    </div>

    <div class="mine-scene" id="gameRoot"></div>

    <div class="mine-info">
      <span id="autoInfo">Miner walks & digs automatically.</span>
      <span id="tapInfo">Tap to help and get extra ore.</span>
    </div>

    <button class="btn-primary" id="mineBtn">üëÜ Tap to help</button>

    <div class="row" style="margin-top:8px;">
      <button class="btn-sm green" id="buyToolBtn">‚öíÔ∏è Buy new pickaxe (20 common)</button>
      <button class="btn-sm gold" id="btnCommonToRare">‚Üª 50 common ‚Üí 1 rare</button>
    </div>
    <div class="row" style="margin-top:6px;">
      <button class="btn-sm gold" id="btnRareToEpic">‚Üª 5 rare ‚Üí 1 epic</button>
      <button class="btn-sm gold" id="btnEpicToDiamond">‚Üª 2 epic ‚Üí 1 üíé</button>
    </div>
    <div class="row" style="margin-top:6px;">
      <button class="btn-sm gold" id="btnDiamondToT21">üíé ‚Üí +1 T21</button>
    </div>

    <div class="log" id="logBox"></div>
  </div>

  <!-- –ë–∞–Ω–∫ -->
  <div class="panel">
    <div class="panel-title">
      <span id="bankTitle">Ton21 Bank</span>
    </div>
    <div class="res-list">
      <div class="res-name" id="lblT21Progress">T21 progress</div>
      <div class="res-val" id="t21ProgressText">0 / 100</div>
      <div class="res-name" id="lblBankRule">Withdrawal rule</div>
      <div class="res-val" id="bankRuleValue">100 T21 = 1 request</div>
    </div>
    <div class="bank-info" id="bankInfoText">
      When you reach 100 T21 in game, you can send a withdrawal request. Real T21 will be paid manually by admin.
    </div>
    <button class="btn-primary" id="withdrawBtn" style="margin-top:8px;">
      üè¶ Request withdrawal (100 T21)
    </button>
  </div>

</div>

<script>
  // -------------------- Game state --------------------
  const state = {
    common: 0,
    rare: 0,
    epic: 0,
    diamonds: 0,
    t21: 0,
    depth: 1,
    toolDurability: 200,
    toolMaxDurability: 200
  };

  let adRunning = false;

  // -------------------- Translations --------------------
  const texts = {
    en: {
      title_main: "Ton21 Mine",
      title_sub: "Early access mining",
      depth: "Depth",
      balances_title: "Balances",
      common: "Common ore",
      rare: "Rare ore",
      epic: "Epic ore",
      diamonds: "Diamonds üíé",
      t21: "T21 (in game)",
      mining: "Mining",
      auto_info: "Miner walks & digs automatically.",
      tap_info: "Tap to help the miner and get extra ore.",
      buy_tool: "‚öíÔ∏è Buy new pickaxe (20 common)",
      c2r: "‚Üª 50 common ‚Üí 1 rare",
      r2e: "‚Üª 5 rare ‚Üí 1 epic",
      e2d: "‚Üª 2 epic ‚Üí 1 üíé",
      d2t21: "üíé ‚Üí +1 T21",
      bank_title: "Ton21 Bank",
      t21_progress: "T21 progress",
      bank_rule: "Withdrawal rule",
      bank_rule_value: "100 T21 = 1 request",
      bank_info: "When you reach 100 T21 in game, you can send a withdrawal request. Real T21 will be paid manually by admin.",
      withdraw_btn: "üè¶ Request withdrawal (100 T21)",
      log_mine: "You helped the miner and got common ore.",
      log_auto: "Miner dug some ore.",
      log_tool_broken: "Your pickaxe is broken. Buy a new one to continue.",
      log_tool_buy_ok: "New pickaxe bought!",
      log_tool_buy_fail: "Not enough common ore to buy a pickaxe.",
      log_c2r_fail: "You need 50 common ore for exchange.",
      log_c2r_ok: "Exchange: 50 common ‚Üí +1 rare.",
      log_r2e_fail: "You need 5 rare ore for exchange.",
      log_r2e_ok: "Exchange: 5 rare ‚Üí +1 epic.",
      log_e2d_fail: "You need 2 epic ore for exchange.",
      log_e2d_ok: "Exchange: 2 epic ‚Üí +1 diamond.",
      log_d2t21_fail: "You need 1 diamond for +1 T21.",
      log_d2t21_ok: "Diamond converted ‚Üí +1 T21.",
      log_withdraw_fail: "You need at least 100 T21 to request a withdrawal.",
      log_withdraw_ok: "Withdrawal request prepared. TON address: ",
      ad_title: "Rewarded ad is playing...\nPlease wait 7 seconds.",
      ad_done: "Ad finished, exchange completed!"
    },
    ru: {
      title_main: "Ton21 Mine",
      title_sub: "–†–∞–Ω–Ω–∏–π –¥–æ—Å—Ç—É–ø –∫ –º–∞–π–Ω–∏–Ω–≥—É",
      depth: "–ì–ª—É–±–∏–Ω–∞",
      balances_title: "–ë–∞–ª–∞–Ω—Å —Ä–µ—Å—É—Ä—Å–æ–≤",
      common: "–û–±—ã—á–Ω–∞—è —Ä—É–¥–∞",
      rare: "–†–µ–¥–∫–∞—è —Ä—É–¥–∞",
      epic: "–≠–ø–∏—á–µ—Å–∫–∞—è —Ä—É–¥–∞",
      diamonds: "–ë—Ä–∏–ª–ª–∏–∞–Ω—Ç—ã üíé",
      t21: "T21 (–≤ –∏–≥—Ä–µ)",
      mining: "–î–æ–±—ã—á–∞",
      auto_info: "–®–∞—Ö—Ç—ë—Ä —Ö–æ–¥–∏—Ç –∏ –¥–æ–±—ã–≤–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.",
      tap_info: "–ù–∞–∂–∏–º–∞–π, —á—Ç–æ–±—ã –ø–æ–º–æ—á—å —à–∞—Ö—Ç—ë—Ä—É –∏ –ø–æ–ª—É—á–∏—Ç—å –µ—â—ë —Ä—É–¥—ã.",
      buy_tool: "‚öíÔ∏è –ö—É–ø–∏—Ç—å –∫–∏—Ä–∫—É (20 –æ–±—ã—á–Ω–æ–π)",
      c2r: "‚Üª 50 –æ–±—ã—á–Ω–æ–π ‚Üí 1 —Ä–µ–¥–∫–∞—è",
      r2e: "‚Üª 5 —Ä–µ–¥–∫–∏—Ö ‚Üí 1 —ç–ø–∏—á–µ—Å–∫–∞—è",
      e2d: "‚Üª 2 —ç–ø–∏—á–µ—Å–∫–∏–µ ‚Üí 1 üíé",
      d2t21: "üíé ‚Üí +1 T21",
      bank_title: "–ë–∞–Ω–∫ Ton21",
      t21_progress: "–ü—Ä–æ–≥—Ä–µ—Å—Å T21",
      bank_rule: "–ü—Ä–∞–≤–∏–ª–æ –≤—ã–≤–æ–¥–∞",
      bank_rule_value: "100 T21 = 1 –∑–∞—è–≤–∫–∞",
      bank_info: "–ö–æ–≥–¥–∞ –Ω–∞–∫–æ–ø–∏—Ç–µ 100 T21 –≤ –∏–≥—Ä–µ, —Å–º–æ–∂–µ—Ç–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É –Ω–∞ –≤—ã–≤–æ–¥. –†–µ–∞–ª—å–Ω—ã–µ T21 –≤—ã–ø–ª–∞—á–∏–≤–∞—é—Ç—Å—è –≤—Ä—É—á–Ω—É—é –∞–¥–º–∏–Ω–æ–º.",
      withdraw_btn: "üè¶ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É (100 T21)",
      log_mine: "–í—ã –ø–æ–º–æ–≥–ª–∏ —à–∞—Ö—Ç—ë—Ä—É –∏ –ø–æ–ª—É—á–∏–ª–∏ –æ–±—ã—á–Ω—É—é —Ä—É–¥—É.",
      log_auto: "–®–∞—Ö—Ç—ë—Ä –¥–æ–±—ã–ª –Ω–µ–º–Ω–æ–≥–æ —Ä—É–¥—ã.",
      log_tool_broken: "–ö–∏—Ä–∫–∞ —Å–ª–æ–º–∞–ª–∞—Å—å. –ö—É–ø–∏—Ç–µ –Ω–æ–≤—É—é, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å.",
      log_tool_buy_ok: "–ù–æ–≤–∞—è –∫–∏—Ä–∫–∞ –∫—É–ø–ª–µ–Ω–∞!",
      log_tool_buy_fail: "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ–±—ã—á–Ω–æ–π —Ä—É–¥—ã –¥–ª—è –ø–æ–∫—É–ø–∫–∏ –∫–∏—Ä–∫–∏.",
      log_c2r_fail: "–ù—É–∂–Ω–æ 50 –æ–±—ã—á–Ω–æ–π —Ä—É–¥—ã –¥–ª—è –æ–±–º–µ–Ω–∞.",
      log_c2r_ok: "–û–±–º–µ–Ω: 50 –æ–±—ã—á–Ω–æ–π ‚Üí +1 —Ä–µ–¥–∫–∞—è.",
      log_r2e_fail: "–ù—É–∂–Ω–æ 5 —Ä–µ–¥–∫–∏—Ö —Ä—É–¥ –¥–ª—è –æ–±–º–µ–Ω–∞.",
      log_r2e_ok: "–û–±–º–µ–Ω: 5 —Ä–µ–¥–∫–∏—Ö ‚Üí +1 —ç–ø–∏—á–µ—Å–∫–∞—è.",
      log_e2d_fail: "–ù—É–∂–Ω–æ 2 —ç–ø–∏—á–µ—Å–∫–∏–µ —Ä—É–¥—ã –¥–ª—è –æ–±–º–µ–Ω–∞.",
      log_e2d_ok: "–û–±–º–µ–Ω: 2 —ç–ø–∏—á–µ—Å–∫–∏–µ ‚Üí +1 –±—Ä–∏–ª–ª–∏–∞–Ω—Ç.",
      log_d2t21_fail: "–ù—É–∂–µ–Ω 1 –±—Ä–∏–ª–ª–∏–∞–Ω—Ç –¥–ª—è +1 T21.",
      log_d2t21_ok: "–ë—Ä–∏–ª–ª–∏–∞–Ω—Ç –æ–±–º–µ–Ω—è–Ω ‚Üí +1 T21.",
      log_withdraw_fail: "–ù—É–∂–Ω–æ –º–∏–Ω–∏–º—É–º 100 T21, —á—Ç–æ–±—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É.",
      log_withdraw_ok: "–ó–∞—è–≤–∫–∞ –Ω–∞ –≤—ã–≤–æ–¥ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–∞. TON-–∞–¥—Ä–µ—Å: ",
      ad_title: "–ò–¥—ë—Ç –ø–æ–∫–∞–∑ —Ä–µ–∫–ª–∞–º—ã...\n–ü–æ–¥–æ–∂–¥–∏—Ç–µ 7 —Å–µ–∫—É–Ω–¥.",
      ad_done: "–†–µ–∫–ª–∞–º–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞, –æ–±–º–µ–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω!"
    },
    cn: {
      title_main: "Ton21 Mine",
      title_sub: "T21 Êó©ÊúüÊåñÁüø",
      depth: "Ê∑±Â∫¶",
      balances_title: "ËµÑÊ∫ê‰ΩôÈ¢ù",
      common: "ÊôÆÈÄöÁüøÁü≥",
      rare: "Á®ÄÊúâÁüøÁü≥",
      epic: "Âè≤ËØóÁüøÁü≥",
      diamonds: "ÈíªÁü≥ üíé",
      t21: "T21ÔºàÊ∏∏ÊàèÂÜÖÔºâ",
      mining: "ÊåñÁüø",
      auto_info: "ÁüøÂ∑•Ëá™Âä®Ëµ∞Âä®Âπ∂ÊåñÁüø„ÄÇ",
      tap_info: "ÁÇπÂáªÂ∏ÆÂä©ÁüøÂ∑•ÔºåËé∑ÂæóÈ¢ùÂ§ñÁüøÁü≥„ÄÇ",
      buy_tool: "‚öíÔ∏è Ë¥≠‰π∞ÈïêÂ≠êÔºà20 ÊôÆÈÄöÁüøÁü≥Ôºâ",
      c2r: "‚Üª 50 ÊôÆÈÄö ‚Üí 1 Á®ÄÊúâ",
      r2e: "‚Üª 5 Á®ÄÊúâ ‚Üí 1 Âè≤ËØó",
      e2d: "‚Üª 2 Âè≤ËØó ‚Üí 1 üíé",
      d2t21: "üíé ‚Üí +1 T21",
      bank_title: "Ton21 Èì∂Ë°å",
      t21_progress: "T21 ËøõÂ∫¶",
      bank_rule: "ÊèêÁé∞ËßÑÂàô",
      bank_rule_value: "100 T21 = 1 Ê¨°Áî≥ËØ∑",
      bank_info: "ÂΩì‰Ω†Âú®Ê∏∏Êàè‰∏≠Ëé∑Âæó 100 T21 Êó∂ÔºåÂèØ‰ª•Êèê‰∫§ÊèêÁé∞Áî≥ËØ∑„ÄÇÁúüÂÆû T21 Â∞ÜÁî±ÁÆ°ÁêÜÂëòÊâãÂä®ÂèëÊîæ„ÄÇ",
      withdraw_btn: "üè¶ Êèê‰∫§ÊèêÁé∞Áî≥ËØ∑ (100 T21)",
      log_mine: "‰Ω†Â∏ÆÂä©‰∫ÜÁüøÂ∑•ÔºåËé∑Âæó‰∫ÜÊôÆÈÄöÁüøÁü≥„ÄÇ",
      log_auto: "ÁüøÂ∑•Ëá™Âä®ÊåñÂà∞‰∫Ü‰∏Ä‰∫õÁüøÁü≥„ÄÇ",
      log_tool_broken: "ÈïêÂ≠êÂùè‰∫ÜÔºåÈúÄË¶ÅË¥≠‰π∞Êñ∞ÁöÑ„ÄÇ",
      log_tool_buy_ok: "Â∑≤Ë¥≠‰π∞Êñ∞ÁöÑÈïêÂ≠êÔºÅ",
      log_tool_buy_fail: "ÊôÆÈÄöÁüøÁü≥‰∏çË∂≥ÔºåÊó†Ê≥ïË¥≠‰π∞ÈïêÂ≠ê„ÄÇ",
      log_c2r_fail: "ÈúÄË¶Å 50 ÊôÆÈÄöÁüøÁü≥ÊâçËÉΩÂÖëÊç¢„ÄÇ",
      log_c2r_ok: "ÂÖëÊç¢Ôºö50 ÊôÆÈÄö ‚Üí +1 Á®ÄÊúâ„ÄÇ",
      log_r2e_fail: "ÈúÄË¶Å 5 Á®ÄÊúâÁüøÁü≥ÊâçËÉΩÂÖëÊç¢„ÄÇ",
      log_r2e_ok: "ÂÖëÊç¢Ôºö5 Á®ÄÊúâ ‚Üí +1 Âè≤ËØó„ÄÇ",
      log_e2d_fail: "ÈúÄË¶Å 2 Âè≤ËØóÁüøÁü≥ÊâçËÉΩÂÖëÊç¢„ÄÇ",
      log_e2d_ok: "ÂÖëÊç¢Ôºö2 Âè≤ËØó ‚Üí +1 ÈíªÁü≥„ÄÇ",
      log_d2t21_fail: "ÈúÄË¶Å 1 È¢óÈíªÁü≥ÊâçËÉΩËé∑Âæó +1 T21„ÄÇ",
      log_d2t21_ok: "ÈíªÁü≥Â∑≤ÂÖëÊç¢ ‚Üí +1 T21„ÄÇ",
      log_withdraw_fail: "ÈúÄË¶ÅËá≥Â∞ë 100 T21 ÊâçËÉΩÁî≥ËØ∑ÊèêÁé∞„ÄÇ",
      log_withdraw_ok: "ÊèêÁé∞Áî≥ËØ∑Â∑≤ÂáÜÂ§á„ÄÇTON Âú∞ÂùÄÔºö",
      ad_title: "Ê≠£Âú®Êí≠ÊîæÊøÄÂä±ÂπøÂëä‚Ä¶\nËØ∑Á≠âÂæÖ 7 Áßí„ÄÇ",
      ad_done: "ÂπøÂëäÁªìÊùüÔºåÂÖëÊç¢ÂÆåÊàêÔºÅ"
    },
    in: {
      title_main: "Ton21 Mine",
      title_sub: "T21 ‡§ï‡§æ ‡§™‡•ç‡§∞‡§æ‡§∞‡§Ç‡§≠‡§ø‡§ï ‡§Æ‡§æ‡§á‡§®‡§ø‡§Ç‡§ó",
      depth: "‡§ó‡§π‡§∞‡§æ‡§à",
      balances_title: "‡§∏‡§Ç‡§∏‡§æ‡§ß‡§® ‡§¨‡•à‡§≤‡•á‡§Ç‡§∏",
      common: "‡§∏‡§æ‡§ß‡§æ‡§∞‡§£ ‡§Ö‡§Ø‡§∏‡•ç‡§ï",
      rare: "‡§¶‡•Å‡§∞‡•ç‡§≤‡§≠ ‡§Ö‡§Ø‡§∏‡•ç‡§ï",
      epic: "‡§è‡§™‡§ø‡§ï ‡§Ö‡§Ø‡§∏‡•ç‡§ï",
      diamonds: "‡§π‡•Ä‡§∞‡•á üíé",
      t21: "T21 (‡§ó‡•á‡§Æ ‡§Æ‡•á‡§Ç)",
      mining: "‡§Æ‡§æ‡§á‡§®‡§ø‡§Ç‡§ó",
      auto_info: "‡§ñ‡§®‡§ø‡§ï ‡§Ö‡§™‡§®‡•á ‡§Ü‡§™ ‡§ö‡§≤‡§§‡§æ ‡§î‡§∞ ‡§ñ‡•ã‡§¶‡§§‡§æ ‡§π‡•à‡•§",
      tap_info: "‡§ñ‡§®‡§ø‡§ï ‡§ï‡•Ä ‡§Æ‡§¶‡§¶ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ü‡•à‡§™ ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§Ö‡§§‡§ø‡§∞‡§ø‡§ï‡•ç‡§§ ‡§Ö‡§Ø‡§∏‡•ç‡§ï ‡§™‡§æ‡§è‡§Ç‡•§",
      buy_tool: "‚öíÔ∏è ‡§®‡§Ø‡§æ ‡§™‡§ø‡§ï‡•à‡§ï‡•ç‡§∏ ‡§ñ‡§∞‡•Ä‡§¶‡•á‡§Ç (20 ‡§∏‡§æ‡§ß‡§æ‡§∞‡§£)",
      c2r: "‚Üª 50 ‡§∏‡§æ‡§ß‡§æ‡§∞‡§£ ‚Üí 1 ‡§¶‡•Å‡§∞‡•ç‡§≤‡§≠",
      r2e: "‚Üª 5 ‡§¶‡•Å‡§∞‡•ç‡§≤‡§≠ ‚Üí 1 ‡§è‡§™‡§ø‡§ï",
      e2d: "‚Üª 2 ‡§è‡§™‡§ø‡§ï ‚Üí 1 üíé",
      d2t21: "üíé ‚Üí +1 T21",
      bank_title: "Ton21 ‡§¨‡•à‡§Ç‡§ï",
      t21_progress: "T21 ‡§™‡•ç‡§∞‡§ó‡§§‡§ø",
      bank_rule: "‡§®‡§ø‡§ï‡§æ‡§∏‡•Ä ‡§®‡§ø‡§Ø‡§Æ",
      bank_rule_value: "100 T21 = 1 ‡§∞‡§ø‡§ï‡•ç‡§µ‡•á‡§∏‡•ç‡§ü",
      bank_info: "‡§ú‡§¨ ‡§Ü‡§™‡§ï‡•á ‡§™‡§æ‡§∏ 100 T21 ‡§π‡•ã ‡§ú‡§æ‡§è‡§Ç‡§ó‡•á, ‡§§‡•ã ‡§Ü‡§™ ‡§®‡§ø‡§ï‡§æ‡§∏‡•Ä ‡§∞‡§ø‡§ï‡•ç‡§µ‡•á‡§∏‡•ç‡§ü ‡§≠‡•á‡§ú ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§ ‡§Ö‡§∏‡§≤‡•Ä T21 ‡§è‡§°‡§Æ‡§ø‡§® ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§Æ‡•à‡§®‡•ç‡§Ø‡•Å‡§Ö‡§≤‡•Ä ‡§≠‡•á‡§ú‡•á ‡§ú‡§æ‡§è‡§Ç‡§ó‡•á‡•§",
      withdraw_btn: "üè¶ ‡§®‡§ø‡§ï‡§æ‡§∏‡•Ä ‡§∞‡§ø‡§ï‡•ç‡§µ‡•á‡§∏‡•ç‡§ü (100 T21)",
      log_mine: "‡§Ü‡§™‡§®‡•á ‡§ñ‡§®‡§ø‡§ï ‡§ï‡•Ä ‡§Æ‡§¶‡§¶ ‡§ï‡•Ä ‡§î‡§∞ ‡§∏‡§æ‡§ß‡§æ‡§∞‡§£ ‡§Ö‡§Ø‡§∏‡•ç‡§ï ‡§™‡§æ‡§Ø‡§æ‡•§",
      log_auto: "‡§ñ‡§®‡§ø‡§ï ‡§®‡•á ‡§ï‡•Å‡§õ ‡§Ö‡§Ø‡§∏‡•ç‡§ï ‡§ñ‡•ã‡§¶‡§æ‡•§",
      log_tool_broken: "‡§Ü‡§™‡§ï‡§æ ‡§™‡§ø‡§ï‡•à‡§ï‡•ç‡§∏ ‡§ü‡•Ç‡§ü ‡§ó‡§Ø‡§æ‡•§ ‡§ú‡§æ‡§∞‡•Ä ‡§∞‡§ñ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§®‡§Ø‡§æ ‡§ñ‡§∞‡•Ä‡§¶‡•á‡§Ç‡•§",
      log_tool_buy_ok: "‡§®‡§Ø‡§æ ‡§™‡§ø‡§ï‡•à‡§ï‡•ç‡§∏ ‡§ñ‡§∞‡•Ä‡§¶‡§æ ‡§ó‡§Ø‡§æ!",
      log_tool_buy_fail: "‡§™‡§ø‡§ï‡•à‡§ï‡•ç‡§∏ ‡§ñ‡§∞‡•Ä‡§¶‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡§æ‡§ß‡§æ‡§∞‡§£ ‡§Ö‡§Ø‡§∏‡•ç‡§ï ‡§™‡§∞‡•ç‡§Ø‡§æ‡§™‡•ç‡§§ ‡§®‡§π‡•Ä‡§Ç‡•§",
      log_c2r_fail: "‡§è‡§ï‡•ç‡§∏‡§ö‡•á‡§Ç‡§ú ‡§ï‡•á ‡§≤‡§ø‡§è 50 ‡§∏‡§æ‡§ß‡§æ‡§∞‡§£ ‡§Ö‡§Ø‡§∏‡•ç‡§ï ‡§ö‡§æ‡§π‡§ø‡§è‡•§",
      log_c2r_ok: "‡§è‡§ï‡•ç‡§∏‡§ö‡•á‡§Ç‡§ú: 50 ‡§∏‡§æ‡§ß‡§æ‡§∞‡§£ ‚Üí +1 ‡§¶‡•Å‡§∞‡•ç‡§≤‡§≠‡•§",
      log_r2e_fail: "‡§è‡§ï‡•ç‡§∏‡§ö‡•á‡§Ç‡§ú ‡§ï‡•á ‡§≤‡§ø‡§è 5 ‡§¶‡•Å‡§∞‡•ç‡§≤‡§≠ ‡§Ö‡§Ø‡§∏‡•ç‡§ï ‡§ö‡§æ‡§π‡§ø‡§è‡•§",
      log_r2e_ok: "‡§è‡§ï‡•ç‡§∏‡§ö‡•á‡§Ç‡§ú: 5 ‡§¶‡•Å‡§∞‡•ç‡§≤‡§≠ ‚Üí +1 ‡§è‡§™‡§ø‡§ï‡•§",
      log_e2d_fail: "‡§è‡§ï‡•ç‡§∏‡§ö‡•á‡§Ç‡§ú ‡§ï‡•á ‡§≤‡§ø‡§è 2 ‡§è‡§™‡§ø‡§ï ‡§Ö‡§Ø‡§∏‡•ç‡§ï ‡§ö‡§æ‡§π‡§ø‡§è‡•§",
      log_e2d_ok: "‡§è‡§ï‡•ç‡§∏‡§ö‡•á‡§Ç‡§ú: 2 ‡§è‡§™‡§ø‡§ï ‚Üí +1 ‡§π‡•Ä‡§∞‡§æ‡•§",
      log_d2t21_fail: "+1 T21 ‡§ï‡•á ‡§≤‡§ø‡§è 1 ‡§π‡•Ä‡§∞‡§æ ‡§ö‡§æ‡§π‡§ø‡§è‡•§",
      log_d2t21_ok: "‡§π‡•Ä‡§∞‡§æ ‡§è‡§ï‡•ç‡§∏‡§ö‡•á‡§Ç‡§ú ‡§π‡•Å‡§Ü ‚Üí +1 T21‡•§",
      log_withdraw_fail: "‡§®‡§ø‡§ï‡§æ‡§∏‡•Ä ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡§Æ ‡§∏‡•á ‡§ï‡§Æ 100 T21 ‡§ö‡§æ‡§π‡§ø‡§è‡•§",
      log_withdraw_ok: "‡§®‡§ø‡§ï‡§æ‡§∏‡•Ä ‡§∞‡§ø‡§ï‡•ç‡§µ‡•á‡§∏‡•ç‡§ü ‡§§‡•à‡§Ø‡§æ‡§∞‡•§ TON ‡§™‡§§‡§æ: ",
      ad_title: "Rewarded ad ‡§ö‡§≤ ‡§∞‡§π‡§æ ‡§π‡•à‚Ä¶\n‡§ï‡•É‡§™‡§Ø‡§æ 7 ‡§∏‡•á‡§ï‡§Ç‡§° ‡§á‡§Ç‡§§‡§ú‡§º‡§æ‡§∞ ‡§ï‡§∞‡•á‡§Ç‡•§",
      ad_done: "Ad ‡§ñ‡§§‡•ç‡§Æ, ‡§è‡§ï‡•ç‡§∏‡§ö‡•á‡§Ç‡§ú ‡§™‡•Ç‡§∞‡§æ!"
    },
    am: {
      title_main: "Ton21 Mine",
      title_sub: "T21-’´ ’æ’°’≤ ’¥’°’µ’∂’´’∂’£",
      depth: "‘Ω’∏÷Ä’∏÷Ç’©’µ’∏÷Ç’∂",
      balances_title: "’ä’°’∑’°÷Ä’∂’•÷Ä’´ ’¥’∂’°÷Å’∏÷Ä’§",
      common: "’ç’∏’æ’∏÷Ä’°’Ø’°’∂ ’∞’°’∂÷Ñ’°÷Ñ’°÷Ä",
      rare: "‘ø÷Ä’Ø. ’∞’°’∂÷Ñ’°÷Ñ’°÷Ä",
      epic: "‘∑’∫’´’Ø ’∞’°’∂÷Ñ’°÷Ñ’°÷Ä",
      diamonds: "‘±’Ø’∂’∂’•÷Ä üíé",
      t21: "T21 (’≠’°’≤’∏÷Ç’¥)",
      mining: "’Ä’°’∂÷Ñ’°÷É’∏÷Ä’∏÷Ç’¥",
      auto_info: "’Ä’°’∂÷Ñ’°’£’∏÷Ä’Æ’® ÷Ñ’°’µ’¨’∏÷Ç’¥ ’ß ÷á ’∞’°’∂’∏÷Ç’¥ ’∞’°’∂÷Ñ’°÷Ñ’°÷Ä ’°’æ’ø’∏’¥’°’ø÷â",
      tap_info: "’ç’•’≤’¥’´÷Ä, ’∏÷Ä ÷Ö’£’∂’•’Ω ’∞’°’∂÷Ñ’°’£’∏÷Ä’Æ’´’∂ ÷á ’Ω’ø’°’∂’°’Ω ’°’æ’•’¨’´ ’∑’°’ø ’∞’°’∂÷Ñ’°÷Ñ’°÷Ä÷â",
      buy_tool: "‚öíÔ∏è ‘≥’∂’•’¨ ’∂’∏÷Ä ’¢’°’∞’°’Ø (20 ’Ω’∏’æ’∏÷Ä’°’Ø’°’∂)",
      c2r: "‚Üª 50 ’Ω’∏’æ’∏÷Ä. ‚Üí 1 ’Ø÷Ä’Ø.",
      r2e: "‚Üª 5 ’Ø÷Ä’Ø. ‚Üí 1 ’ß’∫’´’Ø",
      e2d: "‚Üª 2 ’ß’∫’´’Ø ‚Üí 1 üíé",
      d2t21: "üíé ‚Üí +1 T21",
      bank_title: "Ton21 ‘≤’°’∂’Ø",
      t21_progress: "T21 ’°’º’°’ª’®’∂’©’°÷Å",
      bank_rule: "‘¥’∏÷Ç÷Ä’Ω’¢’•÷Ä’¥’°’∂ ’Ø’°’∂’∏’∂",
      bank_rule_value: "100 T21 = 1 ’∞’°’µ’ø",
      bank_info: "‘µ÷Ä’¢ ’≠’°’≤’∏÷Ç’¥ ’Ø’∏÷Ç’∂’•’∂’°÷Ñ 100 T21, ’Ø’°÷Ä’∏’≤ ’•÷Ñ ’∏÷Ç’≤’°÷Ä’Ø’•’¨ ’∞’°’µ’ø ’§’∏÷Ç÷Ä’Ω’¢’•÷Ä’¥’°’∂ ’∞’°’¥’°÷Ä÷â ‘ª÷Ä’°’Ø’°’∂ T21-’® ’Ø’æ’≥’°÷Ä’æ’´ ’°’§’¥’´’∂’´ ’Ø’∏’≤’¥’´÷Å ’±’•’º÷Ñ’∏’æ.",
      withdraw_btn: "üè¶ ’à÷Ç’≤’°÷Ä’Ø’•’¨ ’∞’°’µ’ø (100 T21)",
      log_mine: "‘¥’∏÷Ç÷Ñ ÷Ö’£’∂’•÷Å’´÷Ñ ’∞’°’∂÷Ñ’°’£’∏÷Ä’Æ’´’∂ ÷á ’Ω’ø’°÷Å’°÷Ñ ’Ω’∏’æ’∏÷Ä’°’Ø’°’∂ ’∞’°’∂÷Ñ’°÷Ñ’°÷Ä÷â",
      log_auto: "’Ä’°’∂÷Ñ’°’£’∏÷Ä’Æ’® ’°’æ’ø’∏’¥’°’ø ’∞’°’∂’•’¨ ’ß ’∞’°’∂÷Ñ’°÷Ñ’°÷Ä÷â",
      log_tool_broken: "‘≤’°’∞’°’Ø’® ’Ø’∏’ø÷Ä’æ’•÷Å÷â ‘≥’∂’•÷Ñ ’∂’∏÷Ä, ’∏÷Ä’∫’•’Ω’¶’´ ’∑’°÷Ä’∏÷Ç’∂’°’Ø’•÷Ñ÷â",
      log_tool_buy_ok: "’Ü’∏÷Ä ’¢’°’∞’°’Ø’∂ ’£’∂’æ’°’Æ ’ß÷â",
      log_tool_buy_fail: "‘≤’°’æ’°÷Ä’°÷Ä ’Ω’∏’æ’∏÷Ä’°’Ø’°’∂ ’∞’°’∂÷Ñ’°÷Ñ’°÷Ä ’π’Ø’° ’¢’°’∞’°’Ø ’£’∂’•’¨’∏÷Ç ’∞’°’¥’°÷Ä÷â",
      log_c2r_fail: "’ä’•’ø÷Ñ ’ß 50 ’Ω’∏’æ’∏÷Ä’°’Ø’°’∂ ’∞’°’∂÷Ñ’°÷Ñ’°÷Ä’ù ÷É’∏’≠’°’∂’°’Ø’¥’°’∂ ’∞’°’¥’°÷Ä÷â",
      log_c2r_ok: "’ì’∏’≠’°’∂’°’Ø’∏÷Ç’¥’ù 50 ’Ω’∏’æ’∏÷Ä. ‚Üí +1 ’Ø÷Ä’Ø.",
      log_r2e_fail: "’ä’•’ø÷Ñ ’ß 5 ’Ø÷Ä’Ø’∂’°’Ø’´ ’∞’°’∂÷Ñ’°÷Ñ’°÷Ä’ù ÷É’∏’≠’°’∂’°’Ø’¥’°’∂ ’∞’°’¥’°÷Ä÷â",
      log_r2e_ok: "’ì’∏’≠’°’∂’°’Ø’∏÷Ç’¥’ù 5 ’Ø÷Ä’Ø. ‚Üí +1 ’ß’∫’´’Ø÷â",
      log_e2d_fail: "’ä’•’ø÷Ñ ’ß 2 ’ß’∫’´’Ø ’∞’°’∂÷Ñ’°÷Ñ’°÷Ä’ù ÷É’∏’≠’°’∂’°’Ø’¥’°’∂ ’∞’°’¥’°÷Ä÷â",
      log_e2d_ok: "’ì’∏’≠’°’∂’°’Ø’∏÷Ç’¥’ù 2 ’ß’∫’´’Ø ‚Üí +1 ’°’Ø’∂÷â",
      log_d2t21_fail: "’ä’•’ø÷Ñ ’ß 1 ’°’Ø’∂’ù +1 T21-’´ ’∞’°’¥’°÷Ä÷â",
      log_d2t21_ok: "‘±’Ø’∂’® ÷É’∏’≠’æ’•÷Å ‚Üí +1 T21÷â",
      log_withdraw_fail: "‘¥’∏÷Ç÷Ä’Ω’¢’•÷Ä’¥’°’∂ ’∞’°’¥’°÷Ä ’∫’•’ø÷Ñ ’ß ’°’º’∂’æ’°’¶’∂ 100 T21÷â",
      log_withdraw_ok: "‘¥’∏÷Ç÷Ä’Ω’¢’•÷Ä’¥’°’∂ ’∞’°’µ’ø’® ’∫’°’ø÷Ä’°’Ω’ø ’ß÷â TON ’∞’°’Ω÷Å’•’ù ",
      ad_title: "‘≥’∏’æ’°’¶’§ ’ß ÷Å’∏÷Ç÷Å’°’§÷Ä’æ’∏÷Ç’¥‚Ä¶\n’ç’∫’°’Ω’•÷Ñ 7 ’æ’°’µ÷Ä’Ø’µ’°’∂÷â",
      ad_done: "‘≥’∏’æ’°’¶’§’∂ ’°’æ’°÷Ä’ø’æ’•÷Å, ÷É’∏’≠’°’∂’°’Ø’∏÷Ç’¥’® ’Ø’°’ø’°÷Ä’æ’°’Æ ’ß÷â"
    }
  };

  let currentLang = localStorage.getItem("t21mine_lang") || "ru";

  function t(key){
    return (texts[currentLang] && texts[currentLang][key]) || texts.en[key] || key;
  }

  const els = {
    depthLabel: document.getElementById("depthLabel"),
    depthLevel: document.getElementById("depthLevel"),
    balancesTitle: document.getElementById("balancesTitle"),
    lblCommon: document.getElementById("lblCommon"),
    lblRare: document.getElementById("lblRare"),
    lblEpic: document.getElementById("lblEpic"),
    lblDiamonds: document.getElementById("lblDiamonds"),
    lblT21: document.getElementById("lblT21"),
    commonOre: document.getElementById("commonOre"),
    rareOre: document.getElementById("rareOre"),
    epicOre: document.getElementById("epicOre"),
    diamondsVal: document.getElementById("diamondsVal"),
    t21Val: document.getElementById("t21Val"),
    mineTitle: document.getElementById("mineTitle"),
    toolInfo: document.getElementById("toolInfo"),
    toolDurability: document.getElementById("toolDurability"),
    bankTitle: document.getElementById("bankTitle"),
    lblT21Progress: document.getElementById("lblT21Progress"),
    lblBankRule: document.getElementById("lblBankRule"),
    bankRuleValue: document.getElementById("bankRuleValue"),
    bankInfoText: document.getElementById("bankInfoText"),
    t21ProgressText: document.getElementById("t21ProgressText"),
    withdrawBtn: document.getElementById("withdrawBtn"),
    logBox: document.getElementById("logBox"),
    mineBtn: document.getElementById("mineBtn"),
    buyToolBtn: document.getElementById("buyToolBtn"),
    btnC2R: document.getElementById("btnCommonToRare"),
    btnR2E: document.getElementById("btnRareToEpic"),
    btnE2D: document.getElementById("btnEpicToDiamond"),
    btnD2T21: document.getElementById("btnDiamondToT21"),
    titleMain: document.getElementById("titleMain"),
    titleSub: document.getElementById("titleSub"),
    adOverlay: document.getElementById("adOverlay"),
    adText: document.getElementById("adText"),
    adTimer: document.getElementById("adTimer"),
    autoInfo: document.getElementById("autoInfo"),
    tapInfo: document.getElementById("tapInfo")
  };

  function applyLang(){
    document.querySelectorAll(".lang-pill").forEach(btn=>{
      btn.classList.toggle("active", btn.dataset.lang === currentLang);
    });
    els.titleMain.textContent = t("title_main");
    els.titleSub.textContent = t("title_sub");
    els.depthLabel.textContent = t("depth");
    els.balancesTitle.textContent = t("balances_title");
    els.lblCommon.textContent = t("common");
    els.lblRare.textContent = t("rare");
    els.lblEpic.textContent = t("epic");
    els.lblDiamonds.textContent = t("diamonds");
    els.lblT21.textContent = t("t21");
    els.mineTitle.textContent = t("mining");
    els.autoInfo.textContent = t("auto_info");
    els.tapInfo.textContent = t("tap_info");
    els.buyToolBtn.textContent = t("buy_tool");
    els.btnC2R.textContent = t("c2r");
    els.btnR2E.textContent = t("r2e");
    els.btnE2D.textContent = t("e2d");
    els.btnD2T21.textContent = t("d2t21");
    els.bankTitle.textContent = t("bank_title");
    els.lblT21Progress.textContent = t("t21_progress");
    els.lblBankRule.textContent = t("bank_rule");
    els.bankRuleValue.textContent = t("bank_rule_value");
    els.bankInfoText.textContent = t("bank_info");
    els.withdrawBtn.textContent = t("withdraw_btn");
    updateUI();
  }

  document.querySelectorAll(".lang-pill").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      currentLang = btn.dataset.lang;
      localStorage.setItem("t21mine_lang", currentLang);
      applyLang();
    });
  });

  function addLog(text){
    const div = document.createElement("div");
    div.className = "log-line";
    div.textContent = text;
    els.logBox.prepend(div);
    const lines = els.logBox.querySelectorAll(".log-line");
    if (lines.length > 40) lines[lines.length-1].remove();
  }

  function updateUI(){
    els.commonOre.textContent = state.common;
    els.rareOre.textContent = state.rare;
    els.epicOre.textContent = state.epic;
    els.diamondsVal.textContent = state.diamonds;
    els.t21Val.textContent = state.t21;
    els.depthLevel.textContent = state.depth;
    els.toolDurability.textContent = state.toolDurability;
    els.t21ProgressText.textContent = state.t21 + " / 100";
    els.withdrawBtn.disabled = state.t21 < 100;
    els.withdrawBtn.style.opacity = state.t21 < 100 ? 0.5 : 1;
  }

  // –ø—Ä–æ—Å—Ç–æ–π –∑–≤—É–∫ —É–¥–∞—Ä–∞ (–±–µ–∑ —Ñ–∞–π–ª–æ–≤)
  function playHitSound(){
    try{
      const ctx = new (window.AudioContext || window.webkitAudioContext)();
      const osc = ctx.createOscillator();
      const gain = ctx.createGain();
      osc.type = "square";
      osc.frequency.value = 450;
      gain.gain.value = 0.15;
      osc.connect(gain);
      gain.connect(ctx.destination);
      osc.start();
      setTimeout(()=>{osc.stop();ctx.close();},120);
    }catch(e){}
  }

  // ----------- Rewarded Ad 7 sec (–∑–∞–≥–ª—É—à–∫–∞) -----------
  function showRewardedAd(callback){
    if (adRunning) return;
    adRunning = true;
    let remaining = 7;
    els.adText.textContent = t("ad_title");
    els.adTimer.textContent = remaining;
    els.adOverlay.style.display = "flex";
    const timer = setInterval(()=>{
      remaining--;
      els.adTimer.textContent = remaining;
      if (remaining <= 0){
        clearInterval(timer);
        els.adOverlay.style.display = "none";
        adRunning = false;
        addLog(t("ad_done"));
        callback();
      }
    },1000);
  }

  // ---------------------- PIXI GAME ----------------------
  let app, miner, pickaxe;
  const oreBlocks = [];
  let minerState = "moving"; // moving | mining | broken
  let minerDir = 1;
  let miningTimer = 0;
  let currentBlock = null;

  function setupPixi(){
    const root = document.getElementById("gameRoot");
    const w = root.clientWidth;
    const h = root.clientHeight;

    app = new PIXI.Application({
      width: w,
      height: h,
      backgroundAlpha: 0,
      antialias:true
    });
    root.innerHTML = "";
    root.appendChild(app.view);

    const layers = new PIXI.Container();
    app.stage.addChild(layers);

    // –Ω–µ–±–æ
    const sky = new PIXI.Graphics();
    sky.beginFill(0x223654);
    sky.drawRect(0,0,w,40);
    sky.endFill();
    layers.addChild(sky);

    // —Å–ª–æ–∏ –≤–Ω–∏–∑
    const colors = [0x2b1f13,0x202436,0x262b42,0x2f344c,0x34395a,0x3c4068];
    for(let i=0;i<6;i++){
      const g = new PIXI.Graphics();
      g.beginFill(colors[i]);
      g.drawRect(0,40+i*25,w,25);
      g.endFill();
      layers.addChild(g);
    }

    // –Ω–∞—á–∞–ª—å–Ω–∞—è —Ä—É–¥–∞
    for(let i=0;i<8;i++) spawnOreBlock();

    // —à–∞—Ö—Ç—ë—Ä
    miner = new PIXI.Container();
    app.stage.addChild(miner);

    const body = new PIXI.Graphics();
    body.beginFill(0xf0c649);
    body.drawRoundedRect(-12,-18,24,24,5);
    body.endFill();

    const head = new PIXI.Graphics();
    head.beginFill(0xf6e0b2);
    head.drawCircle(0,-24,9);
    head.endFill();

    const helmet = new PIXI.Graphics();
    helmet.beginFill(0x1c2739);
    helmet.drawRoundedRect(-11,-30,22,9,4);
    helmet.endFill();
    const light = new PIXI.Graphics();
    light.beginFill(0xfff5a0);
    light.drawCircle(0,-26,4);
    light.endFill();
    helmet.addChild(light);

    pickaxe = new PIXI.Graphics();
    drawPickaxeShape(pickaxe);

    miner.addChild(body,head,helmet,pickaxe);
    miner.x = 40;
    miner.y = depthToY(state.depth);

    app.ticker.add((delta)=>{
      const dt = delta/60;
      if(adRunning) return;
      updateMiner(dt);
      animatePickaxe(delta);
    });
  }

  function drawPickaxeShape(g){
    g.clear();
    g.lineStyle(0);
    g.beginFill(0xcaa24f);
    g.drawRect(0,-8,3,18);
    g.endFill();
    g.beginFill(0xcfd5e8);
    g.drawRoundedRect(-7,-12,17,6,3);
    g.endFill();
    g.pivot.set(1,8);
    g.x = 12;
    g.y = -12;
  }

  function depthToY(depth){
    // 1..6 -> —É—Ä–æ–≤–Ω–∏
    return 55 + (depth-1)*25;
  }

  function spawnOreBlock(){
    const root = document.getElementById("gameRoot");
    if(!root) return;
    const w = root.clientWidth || 360;

    const layer = 1 + Math.floor(Math.random()*6); // 1..6
    const x = 30 + Math.random()*(w-60);
    const y = depthToY(layer) - 4;

    const g = new PIXI.Graphics();
    const color = layer<=2 ? 0xf1c15a : (layer<=4 ? 0x6cc7ff : 0xc86cff);
    g.beginFill(color);
    g.drawRoundedRect(-6,-4,12,8,3);
    g.endFill();
    g.x = x;
    g.y = y;
    app.stage.addChild(g);

    oreBlocks.push({g,layer,collected:false});
  }

  function updateMiner(dt){
    if (state.toolDurability <= 0){
      minerState = "broken";
      return;
    }

    const speed = 45; // px/sec

    if (minerState === "moving"){
      miner.x += minerDir * speed * dt;
      const w = app.view.width;
      if (miner.x < 20){ miner.x = 20; minerDir = 1; }
      if (miner.x > w-20){ miner.x = w-20; minerDir = -1; }

      // –≥–ª—É–±–∏–Ω–∞ –ø–æ state.depth
      miner.y = depthToY(state.depth);

      // –∏—â–µ–º –±–ª–æ–∫ –Ω–∞ —ç—Ç–æ–π –≥–ª—É–±–∏–Ω–µ —Ä—è–¥–æ–º
      let target = null;
      let bestDist = 999;
      for(const b of oreBlocks){
        if (b.collected) continue;
        if (b.layer !== state.depth) continue;
        const d = Math.abs(b.g.x - miner.x);
        if (d < 18 && d < bestDist){
          bestDist = d;
          target = b;
        }
      }
      if (target){
        minerState = "mining";
        currentBlock = target;
        miningTimer = 0;
      }
    } else if (minerState === "mining"){
      miningTimer += dt;
      minerDir = (currentBlock && currentBlock.g.x < miner.x) ? -1 : 1;

      if (miningTimer > 0.1){
        playHitSound();
        state.toolDurability -= 1;
        if (state.toolDurability <= 0){
          minerState = "broken";
          addLog(t("log_tool_broken"));
          updateUI();
          return;
        }
        miningTimer = 0;
        // —à–∞–Ω—Å —Ä–∞–∑—Ä—É—à–∏—Ç—å –±–ª–æ–∫
        if (currentBlock){
          collectBlock(currentBlock);
          currentBlock = null;
          minerState = "moving";
        }
      }
    }
  }

  function animatePickaxe(delta){
    if(!pickaxe) return;
    const base = (minerState === "mining") ? 0.8 : 0.2;
    const amp = (minerState === "mining") ? 0.7 : 0.3;
    pickaxe.rotation = base + Math.sin(performance.now()/120)*(amp);
  }

  function collectBlock(block){
    if (block.collected) return;
    block.collected = true;
    app.stage.removeChild(block.g);

    // –Ω–∞–≥—Ä–∞–¥–∞ –ø–æ –≥–ª—É–±–∏–Ω–µ
    const d = state.depth;
    if (d<=2){
      state.common += 3;
      addLog(t("log_auto"));
    } else if (d<=4){
      state.common += 2;
      state.rare += 1;
      addLog(t("log_auto"));
    } else {
      state.rare += 1;
      const r = Math.random();
      if (r<0.7) state.epic += 1;
      if (r>0.85) state.diamonds += 1;
      addLog(t("log_auto"));
    }

    // –Ω–µ–º–Ω–æ–∂–∫–æ "–≥–ª—É–±–∂–µ" —á–µ–º –±–æ–ª—å—à–µ —Ä—É–¥—ã
    const totalOre = state.common + state.rare*50 + state.epic*250;
    let newDepth = 1;
    if (totalOre > 200) newDepth = 2;
    if (totalOre > 600) newDepth = 3;
    if (totalOre > 1500) newDepth = 4;
    if (totalOre > 3000) newDepth = 5;
    if (totalOre > 6000) newDepth = 6;
    state.depth = newDepth;

    updateUI();

    // —Å–ø–∞–≤–Ω–∏–º –Ω–æ–≤—ã–π –±–ª–æ–∫
    setTimeout(spawnOreBlock, 3000);
  }

  // ------------------ Exchanges & buttons ------------------
  function mineManual(){
    if (state.toolDurability <= 0){
      addLog(t("log_tool_broken"));
      return;
    }
    state.common += 3;
    state.toolDurability -= 1;
    playHitSound();
    addLog(t("log_mine"));
    updateUI();
  }

  function buyTool(){
    const cost = 20;
    if (state.common < cost){
      addLog(t("log_tool_buy_fail"));
      return;
    }
    state.common -= cost;
    state.toolDurability = state.toolMaxDurability;
    minerState = "moving";
    addLog(t("log_tool_buy_ok"));
    updateUI();
  }

  function doCommonToRare(){
    const need = 50;
    if (state.common < need){
      addLog(t("log_c2r_fail"));
      return;
    }
    showRewardedAd(()=>{
      state.common -= need;
      state.rare += 1;
      addLog(t("log_c2r_ok"));
      updateUI();
    });
  }
  function doRareToEpic(){
    const need = 5;
    if (state.rare < need){
      addLog(t("log_r2e_fail"));
      return;
    }
    showRewardedAd(()=>{
      state.rare -= need;
      state.epic += 1;
      addLog(t("log_r2e_ok"));
      updateUI();
    });
  }
  function doEpicToDiamond(){
    const need = 2;
    if (state.epic < need){
      addLog(t("log_e2d_fail"));
      return;
    }
    showRewardedAd(()=>{
      state.epic -= need;
      state.diamonds += 1;
      addLog(t("log_e2d_ok"));
      updateUI();
    });
  }
  function doDiamondToT21(){
    if (state.diamonds < 1){
      addLog(t("log_d2t21_fail"));
      return;
    }
    showRewardedAd(()=>{
      state.diamonds -= 1;
      state.t21 += 1;
      addLog(t("log_d2t21_ok"));
      updateUI();
    });
  }

  function requestWithdrawal(){
    if (state.t21 < 100){
      addLog(t("log_withdraw_fail"));
      return;
    }
    const addr = prompt("Enter your TON address / –í–≤–µ–¥–∏—Ç–µ –≤–∞—à TON-–∞–¥—Ä–µ—Å:");
    if (!addr) return;
    addLog(t("log_withdraw_ok") + addr);
    alert("Request saved locally.\n–í —Ä–µ–∞–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏ —ç—Ç–æ –ø–æ–π–¥—ë—Ç –≤ @Ton21MineBot.\n\nTON: " + addr + "\nAmount: 100 T21");
    state.t21 -= 100;
    updateUI();
  }

  // ------------------ Bind events ------------------
  els.mineBtn.addEventListener("click", mineManual);
  els.buyToolBtn.addEventListener("click", buyTool);
  els.btnC2R.addEventListener("click", doCommonToRare);
  els.btnR2E.addEventListener("click", doRareToEpic);
  els.btnE2D.addEventListener("click", doEpicToDiamond);
  els.btnD2T21.addEventListener("click", doDiamondToT21);
  els.withdrawBtn.addEventListener("click", requestWithdrawal);

  // ------------------ Init ------------------
  applyLang();
  setupPixi();
</script>
</body>
</html>
